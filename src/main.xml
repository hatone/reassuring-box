<?xml version="1.0" encoding="utf-8"?>
<program xmlns="http://www.kinoma.com/kpr/1">
<!-- ++++++++++++++++++++++++++++++++++++++++++++++++++ -->
<!-- my tutorials -->
<!-- ++++++++++++++++++++++++++++++++++++++++++++++++++ -->
	<style id="defaultStyle" font="32px bold" color="white" />
	<label id="mainLabel" width="300" height="24" string="'Hello world'" style="defaultStyle"/>


<!-- ++++++++++++++++++++++++++++++++++++++++++++++++++ -->
<!-- ASSETS -->
<!-- ++++++++++++++++++++++++++++++++++++++++++++++++++ -->

	<skin id="redSkin" color="#FFFF4500"/>
    <skin id="blueSkin" color="#FFADFF2F"/>
    <skin id="buttonSkin">
        <states names="DISABLED,ENABLED,SELECTED" colors="#FFFAEBD7,white,#c44"/>
    </skin>
    <style id="buttonStyle" font="bold 24px" color="black"/>
    <style id="statusFaceStyle" font="120px" color="#FF000000"/>
    <style id="statusMessageStyle" font="bold 30px" color="#FF000000"/>
    
<!-- ++++++++++++++++++++++++++++++++++++++++++++++++++ -->
<!-- VIEWS -->
<!-- ++++++++++++++++++++++++++++++++++++++++++++++++++ -->

	<container id="BlueScreen" left="0" top="0" right="0" bottom="0" skin="blueSkin">
	       <label string="': )'" top="10" style="statusFaceStyle"></label>
	       <label string="'Everything is fine.'" bottom="80" style="statusMessageStyle"></label>

		   <container width="100" height="44" bottom="10" right="10" skin="buttonSkin" active="true">
	       <behavior>
               <method id="onTouchBegan" params="container">
                   <![CDATA[
                   ]]>
               </method>
               <method id="onTouchEnded" params="container">
                   <![CDATA[
                   		changeState(1);
                   ]]>
               </method>
               <method id="onTap" params="container">
                   <![CDATA[

                   ]]>
               </method>
           </behavior>
           <label string="'to red'" style="buttonStyle">

           </label>

	   </container>
	</container>

	<container id="RedScreen" left="0" top="0" right="0" bottom="0" skin="redSkin">
		<label string="': ('" top="10" style="statusFaceStyle"></label>
		<label string="'stove is OK?'" bottom="80" style="statusMessageStyle"></label>

	   	<container width="100" height="44" bottom="20" skin="buttonSkin" active="true">
	       <behavior>
               <method id="onTouchBegan" params="container">
                   <![CDATA[
                   ]]>
               </method>
               <method id="onTouchEnded" params="container">
                   <![CDATA[
                        changeState(0);
                   ]]>
               </method>
               <method id="onTap" params="container">
                   <![CDATA[
                   ]]>
               </method>
           </behavior>
           <label string="'I\'m fine.'" style="buttonStyle">

           </label>
	   </container>
	</container>
	
<!-- ++++++++++++++++++++++++++++++++++++++++++++++++++ -->
<!-- HANDLERS -->
<!-- ++++++++++++++++++++++++++++++++++++++++++++++++++ -->

    <handler path="/sensorCallback">
        <behavior>
            <method id="onInvoke" params="handler, message">
                <![CDATA[
                changeState(0);
                var response = JSON.parse(message.requestText);                    
                    if (response.change) {
                        //trace(message.requestText + "\n");        
                        //changeState(response.state);
                        changeState(1);
                    }
                ]]>

            </method>
        </behavior>
    </handler>

<!-- ++++++++++++++++++++++++++++++++++++++++++++++++++ -->
<!-- BEHAVIORS -->
<!-- ++++++++++++++++++++++++++++++++++++++++++++++++++ -->

    <behavior id="ApplicationBehavior">
    	<method id="onLaunch" params="content">
            <![CDATA[
			var path = mergeURI( application.url, "Sensor.js" ).substring("file://".length);
			var query = {
				scriptPath: path,
				callback: "xkpr://" + application.id + "/sensorCallback",
				sendParamsOnce: true,
				mseconds: Math.floor(1000/60),
				skipFirst: false,
              	};
              	
           	var msg = new Message("xkpr://shell/hardwarepins/repeat?" + serializeQuery(query));
            application.invoke(msg, Message.JSON);
            ]]>
        </method>

        <method id="onComplete" params="application, message, data">
            <![CDATA[
				repeatID = JSON.parse( message.responseText ).id;  
            ]]>
        </method>
    </behavior>

<!-- ++++++++++++++++++++++++++++++++++++++++++++++++++ -->
<!-- SCRIPTS -->
<!-- ++++++++++++++++++++++++++++++++++++++++++++++++++ -->
    <script>
        <![CDATA[
         	var repeatID = 0;
            application.behavior = new ApplicationBehavior();
            function changeState(state) {
                if (application.last) {
                    application.remove(application.last);
                }
                var view = new (state ? RedScreen : BlueScreen)();
                application.add(view);
            }

            changeState(0);
        ]]>
    </script>
</program>
